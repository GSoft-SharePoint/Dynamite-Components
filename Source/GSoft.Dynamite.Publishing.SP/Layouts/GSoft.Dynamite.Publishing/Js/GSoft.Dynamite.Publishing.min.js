window.GSoft=window.GSoft||{};window.GSoft.Dynamite=window.GSoft.Dynamite||{},function(n,t,i){function u(n,u,f,e,o){var s=this;s.SearchQuery=n;s.SelectProperties=u;s.SelectPropertiesArray=s.SelectProperties.split(",");s.FilterDefinitions=JSON.parse(f);s.ItemKnockoutTemplate=e;s.ItemJavaScriptViewModel=o;s.Items=ko.observableArray();s.FilteredItems=ko.computed(function(){return ko.utils.arrayFilter(s.Items(),function(n){return _.reduce(s.Filters(),function(t,i){return typeof t=="boolean"?t&&i.Filter(n):t.Filter(n)&&i.Filter(n)})})});s.Filters=ko.observableArray();s.FiltersTitle=ko.observable("Product Filters");s.FiltersResetLabel=ko.observable("Reset");_.each(s.FilterDefinitions,function(filterDefinition){if(filterDefinition.JavaScriptViewModelFilterType&&filterDefinition.Property){try{filterViewModel=eval(filterDefinition.JavaScriptViewModelFilterType)}catch(e){console.log("[Product Showcase Filter] The type '"+filterDefinition.JavaScriptViewModelFilterType+"' couldn't be resolved. Error Msg: "+e.message)}if(typeof filterViewModel!="function"){console.log("[Product Showcase Filter] The type '"+filterDefinition.JavaScriptViewModelFilterType+"' couldn't be resolved. Not a function.");return}var filter=new filterViewModel(filterDefinition.Property,s.Items);s.Filters.push(filter)}});s.ExecuteSearchQuery=function(){var n=r;n+="?querytext='";n+=encodeURIComponent(s.SearchQuery);n+="'&trimduplicates=false&selectproperties='";n+=s.SelectProperties;n+="'&QueryTemplatePropertiesUrl='spfile://webroot/queryparametertemplate.xml'";t.ajax({url:n,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:s.OnQuerySuccess,error:s.OnQuerySuccess})};s.OnQuerySuccess=function(n){var t=n.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;_.each(t,function(result){var itemViewModel=null,item;try{itemViewModel=eval(s.ItemJavaScriptViewModel)}catch(e){console.log("[Product Showcase] The type '"+s.ItemJavaScriptViewModel+"' couldn't be resolved. Error Msg: "+e.message)}if(typeof itemViewModel!="function"){console.log("[Product Showcase] The type '"+s.ItemJavaScriptViewModel+"' couldn't be resolved. Not a function.");return}item=new itemViewModel;_.each(s.SelectPropertiesArray,function(n){var t=_.where(result.Cells.results,{Key:n});t!=null&&t.length>0&&t[0].Value!=i&&typeof item[n]=="function"?item[n](t[0].Value):console.log("[Search REST API] No value found for property with name '"+n+"'.")});s.Items.push(item)})};s.OnQueryError=function(n){console.log("[Search REST API] Error with the API Request.");console.log(n)};s.ResetFilters=function(){_.each(s.Filters(),function(n){n.Reset()})}}var r="/_api/search/query";n.ViewModel=null;n.Initialize=function(i,r,f,e,o){var s=this;t(document).ready(function(){n.ViewModel=new u(i,r,f,e,o);ko.applyBindings(n.ViewModel,t(".showcase")[0]);n.ViewModel.ExecuteSearchQuery()})}}(GSoft.Dynamite.FilteredProductShowcase=GSoft.Dynamite.FilteredProductShowcase||{},jq110);