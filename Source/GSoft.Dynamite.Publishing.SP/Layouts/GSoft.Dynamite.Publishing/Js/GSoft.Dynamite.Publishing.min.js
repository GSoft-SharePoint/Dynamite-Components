window.GSoft=window.GSoft||{};window.GSoft.Dynamite=window.GSoft.Dynamite||{},function(n,t){var i="/_api/search/query";n.Execute=function(n,r,u,f){var e=i;e+="?querytext='";e+=encodeURIComponent(n);e+="'&trimduplicates=false&rowlimit=500&selectproperties='";e+=r;e+="'&QueryTemplatePropertiesUrl='spfile://webroot/queryparametertemplate.xml'";t.ajax({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:u,error:f})}}(GSoft.Dynamite.Search=GSoft.Dynamite.Search||{},jq110),function(n,t,i){function u(n,u,f,e,o,s){var h=this;h.SearchQuery=n;h.SelectProperties=u;h.SelectPropertiesArray=h.SelectProperties.split(",");h.FilterDefinitions=JSON.parse(f);h.ItemKnockoutTemplate=e;h.ItemJavaScriptViewModel=o;h.LazyLoadingTitle=ko.observable("Load more");h.LazyLoadingVisible=ko.observable(!0);h.NoResultTitle=ko.observable("Loading...");h.FiltersTitle=ko.observable("Product Filters");h.FiltersResetLabel=ko.observable("Reset");h.NbFilteredItems=0;h.Callbacks={};s&&(h.Callbacks=JSON.parse(s));h.Items=ko.observableArray();h.FilteredItems=ko.computed(function(){var n=ko.utils.arrayFilter(h.Items(),function(n){return _.reduce(h.Filters(),function(t,i){return typeof t=="boolean"?t&&i.Filter(n):t.Filter(n)&&i.Filter(n)})});return h.ReloadGrid&&h.ReloadGrid(n.length),h.NbFilteredItems=n.length,n});h.Filters=ko.observableArray();_.each(h.FilterDefinitions,function(filterDefinition){if(filterDefinition.JavaScriptViewModelFilterType&&filterDefinition.Property){try{filterViewModel=eval(filterDefinition.JavaScriptViewModelFilterType)}catch(e){console.log("[Product Showcase Filter] The type '"+filterDefinition.JavaScriptViewModelFilterType+"' couldn't be resolved. Error Msg: "+e.message)}if(typeof filterViewModel!="function"){console.log("[Product Showcase Filter] The type '"+filterDefinition.JavaScriptViewModelFilterType+"' couldn't be resolved. Not a function.");return}var filter=new filterViewModel(filterDefinition.Property,h.Items);h.Filters.push(filter)}});h.ExecuteSearchQuery=function(){var n=r;n+="?querytext='";n+=encodeURIComponent(h.SearchQuery);n+="'&trimduplicates=false&rowlimit=500&selectproperties='";n+=h.SelectProperties;n+="'&QueryTemplatePropertiesUrl='spfile://webroot/queryparametertemplate.xml'";t.ajax({url:n,method:"GET",headers:{Accept:"application/json; odata=verbose"},success:h.OnQuerySuccess,error:h.OnQueryError})};h.OnQuerySuccess=function(data){var results=data.d.query.PrimaryQueryResult.RelevantResults.Table.Rows.results;_.each(results,function(result){var itemViewModel=null,item;try{itemViewModel=eval(h.ItemJavaScriptViewModel)}catch(e){console.log("[Product Showcase] The type '"+h.ItemJavaScriptViewModel+"' couldn't be resolved. Error Msg: "+e.message)}if(typeof itemViewModel!="function"){console.log("[Product Showcase] The type '"+h.ItemJavaScriptViewModel+"' couldn't be resolved. Not a function.");return}item=new itemViewModel;_.each(h.SelectPropertiesArray,function(n){var t=_.where(result.Cells.results,{Key:n});t!=null&&t.length>0&&t[0].Value!=i&&typeof item[n]=="function"&&item[n](t[0].Value)});h.Items.push(item)});h.ReloadGrid(h.FilteredItems().length);h.Callbacks&&(h.Callbacks.lazyLoadingTitle&&eval(h.Callbacks.lazyLoadingTitle)(h.LazyLoadingTitle),h.Callbacks.lazyLoadingVisible&&eval(h.Callbacks.lazyLoadingVisible)(h.LazyLoadingVisible,h.FilteredItems().length),h.Callbacks.noResultTitle&&eval(h.Callbacks.noResultTitle)(h.NoResultTitle),h.Callbacks.filtersTitle&&eval(h.Callbacks.filtersTitle)(h.FiltersTitle),h.Callbacks.filtersResetLabel&&eval(h.Callbacks.filtersResetLabel)(h.FiltersResetLabel))};h.OnQueryError=function(n){console.log("[Search REST API] Error with the API Request.");console.log(n)};h.ResetFilters=function(){_.each(h.Filters(),function(n){n.Reset()})};h.LazyLoadingClick=function(){h.Callbacks&&(h.Callbacks.lazyLoadingClickCallback&&eval(h.Callbacks.lazyLoadingClickCallback)(h.NbFilteredItems),h.Callbacks.lazyLoadingVisible&&eval(h.Callbacks.lazyLoadingVisible)(h.LazyLoadingVisible,h.NbFilteredItems))};h.ReloadGrid=function(nbItems){h.Callbacks&&(h.Callbacks.onItemsLoadedCallback&&eval(h.Callbacks.onItemsLoadedCallback)(nbItems),h.Callbacks.lazyLoadingVisible&&eval(h.Callbacks.lazyLoadingVisible)(h.LazyLoadingVisible,nbItems))}}var r="/_api/search/query";n.ViewModel=null;n.Initialize=function(i,r,f,e,o,s){var h=this;t(document).ready(function(){n.ViewModel=new u(i,r,f,e,o,s);ko.applyBindings(n.ViewModel,t(".showcase")[0]);n.ViewModel.ExecuteSearchQuery()})}}(GSoft.Dynamite.FilteredProductShowcase=GSoft.Dynamite.FilteredProductShowcase||{},jq110);